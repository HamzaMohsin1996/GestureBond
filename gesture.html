                <!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Home</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="./Assets/Css/bootstrap.min.css" >
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha512-3M00D/rn8n+2ZVXBO9Hib0GKNpkm8MSUU/e2VNthDyBYxKWG+BftNYYcuEjXlyrSO637tidzMBXfE7sQm0INUg==" crossorigin="anonymous" referrerpolicy="no-referrer" />      <!-- Font Awesome -->
        <link rel="stylesheet" href="./Assets/Css/all.min.css">
        <link rel="stylesheet" href="./Assets/Css/owl.carousel.min.css">
        <link rel="stylesheet" href="./Assets/Css/owl.theme.default.min.css">
        <link rel="stylesheet" href="./Assets/Css/jquery-ui.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />


        <!-- Custom CSS -->
        <link rel="stylesheet" href="./Assets/Css/styles.css">
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@0.8/dist/teachablemachine-pose.min.js"></script>
     </head>

<body>
    <div id="leftwrapper">
        <div class="header">
            <h2>Gesture Bond</h2>
        </div>
        <div class="main-content-inner">
            <div class="container">
                <div class="main-content"> 
            <div class="row w-100 images-in-center align-items-end">
                <audio id="audio-thumbsup" src="./Assets/Images/audio-noti.wav"></audio>

                <div class="col-3 small-gifs position-relative">
                    <p style="
    color: white;
    position: absolute;
    bottom: -60px;
    left: 50%;
    background: #32a0f7;
    padding: 10px;
    border-radius: 10px;">You</p> 
                    <div class="">
                        <img src="./Assets/Images/simple-male2.gif" class="images active left-images" id="left-0">
                     
                    </div>
                 
                    <img src="./Assets/Images/hi-male2.gif" class="images left-images" id="left-1">
                    <img src="./Assets/Images/thumbsup-male2.gif" class="images left-images" id="left-2">
                    <img src="./Assets/Images/heart-male2.gif" class="images left-images" id="left-3">
                    <div >
                        <div class="d-none"><canvas id="canvas" ></canvas></div>
                        <div id="label-container" class="d-flex mt-4 justify-content-lg-around d-none"></div>
                    </div>
                
                </div>

                <div class="col-9 large-gifs  position-relative">
                    <p style="
    color: white;
    position: absolute;
    bottom: -60px;
    left: 50%;
    background: #32a0f7;
    padding: 10px;
    border-radius: 10px;">Alex</p> 
                    <div class="">
                        <img src="./Assets/Images/male.gif" class="images active left-images" id="left-0">
                      
                    </div>
              
                    <img src="./Assets/Images/hi-male.gif" class="images left-images" id="left-1">
                    <img src="./Assets/Images/thumbs-up-male.gif" class="images left-images" id="left-2">
                    <img src="./Assets/Images/hamza.gif" class="images left-images" id="left-3">
                    <img src="./Assets/Images/clap-male.gif" class="images left-images d-none" id="left-4">
                    <div >
                        <div class="d-none"><canvas id="canvas" ></canvas></div>
                        <div id="label-container" class="d-flex mt-4 justify-content-lg-around d-none"></div>
                    </div>
                   
                 
                </div>
                <div class="custom-box-relative">
                    <div class="icons-wrapper">
                        <div id="hearticon" class="bigheart d-none">
                            <img src="./Assets/Images/Heartshape.png" alt="">
                        </div>
                        <div id="thumbsup" class="thumbsup d-none">
                            <img src="./Assets/Images/GestureBond.png" alt="">
                           
                        </div>
                        <div id="handup" class="handraised d-none">
                            <img src="./Assets/Images/GestureBond1.png" alt="">
                        </div>
                    </div>  
                </div>
             
            </div>
                </div>
            </div>
        </div>
        <div class="footer-wrapper-new">
            <div class="button-container">
            
                <button id="end-call"><i class="fas fa-phone"></i></button>
                <button id="chat" class="center-button"><i class="fas fa-comment"></i></button>
              </div>
        </div>
    </div>
    
    <div class="sidebar-wrapper-new" id="sidebar">
        <div class="header-content">
            <div class="chat-header">
                <h5>Messages</h5>
                <button  id="close-btn">
                    <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="chat-messages">
                <!-- Messages will be displayed here -->
              </div>
              <div class="chat-footer">
                <textarea placeholder="Type your message..." id="chattext" rows="1" oninput="autoResize(this)" onkeydown="handleEnter(event)"></textarea>
                <button><i class="fa fa-paper-plane"></i></button>
              </div>
        </div>
    </div>

   
  <!-- Bootstrap JS -->
  <script src="./Assets/Js/jquery-3.5.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="./Assets/Js/popper.min.js"></script>
  <script src="./Assets/Js/bootstrap.bundle.min.js" ></script>
  <script src="./Assets/Js/owl.carousel.min.js"></script>
  <script src="./Assets/Js/custom.js"></script>
      
  <script type="text/javascript">
             
    const sidebar = document.getElementById('sidebar');
    const chattogglebtn = document.getElementById('chat');
    const leftWrapper = document.getElementById('leftwrapper');
    const closeBtn = document.getElementById('close-btn');
    const thumbsupAudio = document.getElementById('audio-thumbsup');
     let lastPlayedAudio = null;
    
    
    chattogglebtn.addEventListener('click', function(){
       sidebar.classList.toggle('active');
       leftWrapper.classList.toggle('active');
    })
    closeBtn.addEventListener('click', function(){
       sidebar.classList.remove('active');
       leftWrapper.classList.remove('active');
    })
                const URL = "https://teachablemachine.withgoogle.com/models/bzj7oGpfh/";
               let model, webcam, ctx, labelContainer, maxPredictions;
           
               async function init() {
                   const modelURL = URL + "model.json";
                   const metadataURL = URL + "metadata.json";
           
                   // load the model and metadata
                   // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
                   // Note: the pose library adds a tmPose object to your window (window.tmPose)
                   model = await tmPose.load(modelURL, metadataURL);
                   maxPredictions = model.getTotalClasses();
           
                   // Convenience function to setup a webcam
                   const size = 200;
                   const flip = true; // whether to flip the webcam
                   webcam = new tmPose.Webcam(size, size, flip); // width, height, flip
                   await webcam.setup(); // request access to the webcam
                   await webcam.play();
                   window.requestAnimationFrame(loop);
           
                   // append/get elements to the DOM
                   const canvas = document.getElementById("canvas");
                   canvas.width = size; canvas.height = size;
                   ctx = canvas.getContext("2d");
                   labelContainer = document.getElementById("label-container");
                   for (let i = 0; i < maxPredictions; i++) { // and class labels
                       labelContainer.appendChild(document.createElement("div"));
                   }
               }
           
           
                       async function loop(timestamp) {
                           webcam.update(); // update the webcam frame
                           await predict();
                           window.requestAnimationFrame(loop);
                       }
                       async function predict() {
                           // Prediction #1: run input through posenet
                           // estimatePose can take in an image, video or canvas html element
                           const { pose, posenetOutput } = await model.estimatePose(webcam.canvas);
                           // Prediction 2: run input through teachable machine classification model
                           const prediction = await model.predict(posenetOutput);
           
                           let maxClassIndex = -1;
                           let maxClassProbability = 0;
           
                           // Mapping of class names to their corresponding image IDs
                           const classToImageMap = {
                               "Hands Up": "left-1",
                               "Thumbs Up": "left-2",
                               "Heart Shape": "left-3",
                               "No Gesture": "left-0",
                           };
                           const classToBodyClassMap = {
                                "Hands Up": "hand-raised",
                                "Thumbs Up": "thumbs-up",
                                "Heart Shape": "heart-shape",
                                "No Gesture": "no-gesture",
                            };
       
                           console.log(prediction); // Log predictions for debugging
           
                           for (let i = 0; i < maxPredictions; i++) {
                               const classPrediction =
                                   prediction[i].className + ": " + prediction[i].probability.toFixed(2);
                               labelContainer.childNodes[i].innerHTML = classPrediction;
           
                               // Check if the current class has the highest probability
                               if (prediction[i].probability > 0.90 && prediction[i].probability > maxClassProbability) {
                                   maxClassProbability = prediction[i].probability;
                                   maxClassIndex = i;
                               }
                           }
                   
    
                           // Update the active image based on the highest probability class
                           if (maxClassIndex !== -1) {
                               const activeClassName = prediction[maxClassIndex].className;
                               const activeImageId = classToImageMap[activeClassName];
                               const activeBodyClass = classToBodyClassMap[activeClassName];
                       
                               if (lastPlayedAudio !== thumbsupAudio) {
                if (lastPlayedAudio) {
                    lastPlayedAudio.pause();
                    lastPlayedAudio.currentTime = 0;
                }
                thumbsupAudio.play();
                lastPlayedAudio = thumbsupAudio;
            }
        
                               
           
                               if (activeImageId) {
                                document.body.className = activeBodyClass;
                                   for (let i = 0; i < 4; i++) { // We have 4 images, update the loop range
                                       const imageElement = document.getElementById(`left-${i}`);
                                       if (`left-${i}` === activeImageId) {
                                           imageElement.classList.add('active');
                                       } else {
                                           imageElement.classList.remove('active');
                                       }
                                   }
                               }
                           } else {
                            document.body.className = "no-gesture";
                               // If no class probability is greater than 0.75, ensure default image is active
                               for (let i = 0; i < 4; i++) { // We have 4 images, update the loop range
                                   const imageElement = document.getElementById(`left-${i}`);
                                   if (i === 0) {
                                       imageElement.classList.add('active');
                                   } else {
                                       imageElement.classList.remove('active');
                                   }
                               }
                               if (lastPlayedAudio) {
            lastPlayedAudio.pause();
            lastPlayedAudio.currentTime = 0;
            lastPlayedAudio = null;
        }
                           }
    
                       
    
    
           
                           // Draw the pose on the canvas
                           drawPose(pose);
                       }
                       
           
               
           
                       function drawPose(pose) {
                           if (webcam.canvas) {
                               ctx.drawImage(webcam.canvas, 0, 0);
                               // draw the keypoints and skeleton
                               if (pose) {
                                   const minPartConfidence = 0.90
                                   ; tmPose.drawKeypoints(pose.keypoints, minPartConfidence, ctx);
                                   tmPose.drawSkeleton(pose.keypoints, minPartConfidence, ctx);
                               }
                           }
                       }
           
                       window.addEventListener("load", init);
                       function autoResize(textarea) {
            textarea.style.height = 'auto'; // Reset height
            textarea.style.height = textarea.scrollHeight + 'px'; // Set to scrollHeight
        }
        function sendMessage() {
            const chatText = document.getElementById('chattext');
            const message = chatText.value.trim();

            if (message) {
                const chatMessages = document.querySelector('.chat-messages');
                const newMessage = document.createElement('div');
                newMessage.classList.add('chat-message', 'user');
                newMessage.textContent = message;

                chatMessages.appendChild(newMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to the bottom

                chatText.value = '';
                autoResize(chatText); // Reset the textarea height
            }
        }

        document.getElementById('sendButton').addEventListener('click', sendMessage);

        function handleEnter(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault(); // Prevent the default behavior of newline
                sendMessage();
            }
        }
                   </script>
    </div>
</body>
</html>
